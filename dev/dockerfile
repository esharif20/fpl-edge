# Use 3.12 (3.13 wheels can be spotty)
FROM python:3.12-slim

# System deps you might need for pandas/numpy (adjust as needed)
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential curl git ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Good Python defaults
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=1 \
    PYTHONPATH=/workspace/src

WORKDIR /workspace

# Leverage Docker layer cache: copy requirements first
COPY requirements.txt /workspace/requirements.txt
RUN if [ -f requirements.txt ]; then pip install --upgrade pip && pip install -r requirements.txt; fi

# Install project in editable mode if you add pyproject.toml later
# COPY pyproject.toml /workspace/pyproject.toml
# RUN pip install -e .

# Copy only whatâ€™s needed for tests (fast!)
COPY src/ /workspace/src/
COPY tests/ /workspace/tests/

# Default command (can be overridden in CI)
CMD ["python", "-m", unittest, "discover", "-s", "tests", "-p", "test*.py", "-v"]
